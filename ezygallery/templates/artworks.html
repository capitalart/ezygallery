{# [WF-STEP-2] This page shows the circled step number at the top of the content, using .page-step-icon #}
{# Use blueprint-prefixed endpoints like 'artwork.home' in url_for #}
{% extends "main.html" %}
{% from 'components/stage_indicator.html' import stage_indicator %}
{% block title %}Artwork Gallery | Ezy Gallery{% endblock %}
{% block content %}
{{ stage_indicator(2, 'Gallery', True) }}

<div class="gallery-section">

  {% if ready_artworks %}
    <h2 class="mb-3">Ready to Analyze</h2>
    <div class="artwork-grid">
      {% for art in ready_artworks %}
      <div class="gallery-card">
        <div class="card-thumb">
          <img class="card-img-top"
               src="{{ url_for('artwork.temp_image', filename=art.thumb) }}"
               alt="{{ art.title }}">
        </div>
        <div class="card-details">
          <div class="file-name" title="{{ art.filename }}">{{ art.filename }}</div>
          <form method="post" action="{{ url_for('artwork.analyze_upload', base=art.base) }}" class="analyze-form">
            <button type="submit" class="btn btn-primary">Analyze</button>
          </form>
        </div>
      </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if processed_artworks %}
    <h2 class="mb-3 mt-5">Processed Artworks</h2>
    <div class="artwork-grid">
      {% for art in processed_artworks %}
      <div class="gallery-card">
        <div class="card-thumb">
          <img class="card-img-top"
               src="{{ url_for('artwork.processed_image', seo_folder=art.seo_folder, filename=art.thumb) }}"
               alt="{{ art.title }}">
        </div>
        <div class="card-details">
          <div class="file-name" title="{{ art.filename }}">{{ art.filename }}</div>
          <a href="{{ url_for('artwork.edit_listing', aspect=art.aspect, filename=art.filename) }}"
             class="btn btn-secondary">Review</a>
        </div>
      </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if finalised_artworks %}
    <h2 class="mb-3 mt-5">Finalised Artworks</h2>
    <div class="artwork-grid">
      {% for art in finalised_artworks %}
      <div class="gallery-card">
        <div class="card-thumb">
          <img class="card-img-top"
               src="{{ url_for('artwork.finalised_image', seo_folder=art.seo_folder, filename=art.thumb) }}"
               alt="{{ art.title }}">
        </div>
        <div class="card-details">
          <div class="file-name" title="{{ art.filename }}">{{ art.filename }}</div>
          <a href="{{ url_for('artwork.edit_listing', aspect=art.aspect, filename=art.filename) }}" class="btn btn-secondary">Edit</a>
        </div>
      </div>
      {% endfor %}
    </div>
  {% endif %}
  {% if not ready_artworks and not processed_artworks and not finalised_artworks %}
    <p class="empty-msg">No artworks found. Please upload artwork to get started!</p>
  {% endif %}

</div>

{% endblock %}
